操作系统实验报告：xv6 启动过程分析

姓名：张蓓蓓
学号：202311691047
班级：23计科2班
GitHub仓库：https://github.com/Beibei-Z-tech/Sophomore-year

---

实验环境
操作系统：Ubuntu 24.04 (ARM64/Emulated)
工具链：gcc, qemu-system-i386, git
主要修改文件：`bootasm.S`, `bootmain.c`, `entry.S`

任务完成情况

 Task 1: 搭建环境与运行
由于我使用的是Mac电脑，因此首先下载了UTM虚拟机配置Linux环境，其次下载了Ubuntu24.04并安装了gcc等需要的工具链
成功配置了 xv6 的开发环境，解决了 QEMU 和 GCC 版本不兼容的问题（通过修改 Makefile 移除 `-Werror`）。

Task 2 & 3: Bootloader 修改与可视化
为了观察启动流程，我在 `bootmain.c` 中添加了串口输出功能。
由于 Boot Sector 只有 512 字节的限制，直接添加字符串会导致 `boot block too large` 错误。我采取了以下优化措施：
1. 代码瘦身：移除了 `serial_puts`，只保留 `serial_putc`。
2. 简化输出：使用单个字符来标记启动阶段：
   - `'1'`: 进入 bootmain
   - `'2'`: ELF 头加载成功
   - `'3'`: 内核加载完毕

此外，我还在 `bootasm.S` 和 `entry.S` 中添加了关于“关闭中断”、“开启保护模式”和“开启分页”的中文注释。

实验结果截图
下图展示了系统成功启动，并打印出 `123` 序列，随后进入 Shell 的过程：
[请在这里直接把你的截图（那张有123和$的黑底图片）拖拽进来，GitHub会自动生成链接]



遇到的问题与解决方案
1. Boot Block 过大：初始修改导致编译后的 bootblock 超过 510 字节。通过使用 `-Os` 优化标志并精简打印字符解决了该问题。
2. Git 推送权限：解决了 GitHub 密码验证失效的问题，配置了 Personal Access Token 进行提交。
3. Mac电脑没有Linux环境，学会了下载UTM虚拟机并配置Linux环境
